# MySQL vs MongoDB 채팅 시스템에 적합한 DBMS 선정 실험

## 1. 서론
채팅 시스템은 실시간 데이터 처리와 안정성이 중요한 현대 애플리케이션의 핵심 요소입니다. 데이터 저장과 처리 성능은 채팅 시스템의 성공적인 구현에 필수적이며, 데이터베이스 선택은 이를 결정짓는 중요한 요인 중 하나입니다. 본 연구에서는 MongoDB와 MySQL을 대상으로 채팅 시스템의 요구사항을 충족시키는 DBMS의 적합성을 분석하였습니다. 이를 실제 운영 환경에 적용하고 성능을 측정하여 효용성을 검증하였습니다.

---

## 2. 연구 배경

### 2.1 선정 주제
Friendship 애플리케이션의 채팅 서비스를 구현하며, 대량의 채팅 데이터를 효율적으로 관리하기 위한 방안을 모색하는 것이 본 연구의 출발점이었습니다. 실시간성을 보장하고 채팅방을 기준으로 복잡한 집계 쿼리를 처리할 수 있는 데이터베이스가 필요했습니다. 이를 위해 샤딩 기법을 포함한 다양한 접근 방식을 검토하였습니다.

### 2.2 채팅 서버 요구사항
1. **채팅 메시지 저장**: 주고받은 채팅 메시지를 서버에 저장하여 기록으로 남깁니다.
2. **최근 채팅 메시지 100개 조회**: 서버와 클라이언트 간 데이터 정합성을 유지하기 위해 최근 100개의 메시지를 동기화합니다.
3. **메시지 읽음 처리**: 상대방이 메시지를 읽었는지 확인할 수 있도록 읽음 상태를 서버에 기록합니다.
4. **읽지 않은 메시지 정보 제공**: 각 채팅방의 읽지 않은 메시지 개수와 최신 메시지 정보를 제공합니다.

---

## 3. 본론

### 3.1 사용 시나리오
하루에 약 100쌍의 사용자가 매칭되어 100개의 채팅방이 생성되며, 각 채팅방에서 평균 100개의 메시지가 오갑니다. 결과적으로 하루 약 10,000개의 메시지가 저장됩니다. 메시지는 법적 대비를 위해 최소 1년간 보관하며, 필요에 따라 저장 기간이 변경될 수 있습니다.

### 3.2 데이터 규모
- **하루 저장 메시지**: 약 10,000건
- **1년 누적 메시지**: 약 3,650,000건
- **누적 채팅방 수**: 약 36,500개
- 각 채팅방 평균 메시지 수: 읽은 메시지 80개, 읽지 않은 메시지 20개

### 3.3 성능 측정
시스템 응답 시간을 측정하기 위해 JMeter를 활용한 부하 테스트를 수행했습니다. 특히 읽지 않은 메시지 정보 제공 기능과 같은 복잡한 쿼리 및 샤딩된 데이터베이스 접근의 성능을 집중적으로 분석했습니다.

### 3.4 실험 환경 설정
1. **MongoDB**:
   - PSA 아키텍처 기반으로 Config 서버 2대, Shard 서버 2대, Mongos 서버 1대 구성.
   - 채팅방 ID를 기준으로 Range Sharding 적용.
2. **MySQL**:
   - 애플리케이션 레벨에서 샤딩 구현.
   - MySQL 서버 2대 구성.
3. **공통 조건**:
   - 인덱스 적용 및 `sort`, `limit` 활용.
   - 각 샤드에 채팅방 ID 기준 18,000개의 데이터 저장.

---

## 4. 실험 결과

### 4.1 응답 시간
| 작업                         | MongoDB 응답 시간 | MySQL 응답 시간 |
|-----------------------------|-----------------|----------------|
| 메시지 저장                  | 89ms            | 80ms           |
| 메시지 읽음 처리             | 79ms            | 80ms           |
| 특정 채팅방 메시지 조회       | 74ms            | 120ms          |
| 읽지 않은 메시지 정보 제공    | 92ms            | 2002ms         |

### 4.2 부하 테스트 (JMeter)
- **테스트 조건**:
  - 100명의 사용자가 동시에 요청.
  - Ramp-up 시간: 1초.
  - 요청 비율:
    - 저장 요청: 60%
    - 읽기 요청: 36%
    - 채팅방 정보 조회: 2%
    - 최근 메시지 100개 조회: 2%

| 지표                         | MongoDB          | MySQL           |
|-----------------------------|------------------|-----------------|
| 평균 응답 시간               | 21ms            | 25ms           |
| 최대 응답 시간               | 67ms            | 260ms          |
| 표준 편차                   | 8.9ms           | 10.51ms        |
| 처리량 (Throughput)          | 1617.6 요청/초  | 1541.8 요청/초 |

MongoDB는 평균 응답 시간, 최대 응답 시간, 표준 편차 모두에서 MySQL보다 우수한 성능을 보였으며, 처리량 또한 더 높았습니다.

---

## 5. 결과 분석

### 5.1 단순 쿼리 성능
- MongoDB는 **auto-commit 처리**와 BSON 기반 저장 구조 덕분에 단순 쿼리에서 빠른 성능을 보였습니다.
- MySQL은 데이터 정합성을 보장하기 위한 추가 검증 단계로 인해 상대적으로 시간이 더 소요되었습니다.

### 5.2 집계 연산 성능
- MongoDB는 **Aggregation Framework**를 사용하여 파이프라인 기반으로 연산을 처리하며, 서브쿼리 없이 메모리 내에서 데이터를 효율적으로 처리했습니다.
- MySQL은 서브쿼리 및 임시 테이블 생성 과정에서 추가 I/O 작업이 발생해 속도가 저하되었습니다.

### 5.3 샤딩 환경
- 단순 쿼리에서는 샤딩의 영향이 크지 않았으나, MongoDB는 집계 연산에서 샤드 간 데이터 접근 자동화로 관리 편의성을 제공했습니다. 반면, MySQL은 샤드를 추가할 때 애플리케이션 개발자의 작업이 필요했습니다.

---

## 6. 결론
- **MongoDB**:
  - 장점: 유연한 데이터 구조, 뛰어난 확장성, Aggregation Framework 활용.
  - 적합성: 실시간성과 확장성이 필요한 채팅 시스템에 적합.
- **MySQL**:
  - 장점: 데이터 정합성과 일관성 보장.
  - 적합성: 데이터 정합성이 중요한 시스템에 적합.

본 연구를 통해 MongoDB는 확장성과 복잡한 데이터 처리에서, MySQL은 정합성과 단순 쿼리에서 각각 강점을 보임을 확인했습니다.
